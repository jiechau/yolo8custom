<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Object Detection with YOLO8N (best.onnx)</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: sans-serif;
      }
      canvas {
        display: block;
        margin: 0 auto;
      }
    </style>
  </head>
  <body>
    <video id="video" width="640" height="480" autoplay playsinline></video>
    <canvas id="canvas"></canvas>
    <script src="https://cdn.jsdelivr.net/npm/onnxjs/dist/onnx.min.js"></script>
    <script>
      const video = document.getElementById("video");
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");

      const setupCamera = async () => {
        const stream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: "environment" },
        });
        video.srcObject = stream;
        video.onloadedmetadata = () => {
          canvas.width = video.videoWidth;
          canvas.height = video.videoHeight;
        };
      };

      const loadModel = async () => {
        const session = await onnx.loadModel("./best.onnx");
        return session;
      };

      const detectObjects = async (session, imageData) => {
        const tensor = new onnx.Tensor(imageData.data, "uint8");
        const result = await session.run([tensor]);
        const boxes = result.boxes;
        const scores = result.scores;
        const labels = result.labels;
        // Process the results and draw bounding boxes on the canvas
        // ...
      };

      const processFrame = async () => {
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const session = await loadModel();
        await detectObjects(session, imageData);
        requestAnimationFrame(processFrame);
      };

      setupCamera().then(processFrame);
    </script>
  </body>
</html>